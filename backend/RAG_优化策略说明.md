# RAG å›¾æ–‡åˆ‡ç‰‡ä¼˜åŒ–ç­–ç•¥è¯´æ˜

## ğŸ“‹ é—®é¢˜è¯Šæ–­

### åŸç‰ˆåˆ‡ç‰‡ç­–ç•¥çš„é—®é¢˜

**æ ¸å¿ƒé—®é¢˜**ï¼šå…¨æ–‡è¢«åˆ‡æˆä¸€ä¸ª chunkï¼Œæ£€ç´¢æ•ˆæœå·®

**æ ¹æœ¬åŸå› **ï¼š

1. **å®Œå…¨ä¾èµ– Title/Header è¯†åˆ«**

   - åªæœ‰ unstructured è¯†åˆ«åˆ° `Title` æˆ– `Header` å…ƒç´ æ—¶æ‰åˆ‡åˆ†
   - Word æ–‡æ¡£å¦‚æœæ ‡é¢˜æ ·å¼ä¸æ ‡å‡†ï¼Œå¯èƒ½æ— æ³•è¯†åˆ«
   - å¯¼è‡´æ•´ä¸ªæ–‡æ¡£æˆä¸ºä¸€ä¸ªå·¨å¤§çš„ chunk

2. **æ— é•¿åº¦é™åˆ¶æœºåˆ¶**

   - æ²¡æœ‰ `max_chunk_size` é™åˆ¶
   - ä¸€ä¸ªç« èŠ‚å†é•¿ä¹Ÿä¸ä¼šåˆ‡åˆ†

3. **æ— é‡å æœºåˆ¶**

   - è·¨ chunk è¾¹ç•Œçš„ç›¸å…³å†…å®¹å¯èƒ½æ£€ç´¢ä¸åˆ°

4. **æ ‡é¢˜è¯†åˆ«ä¸å¤Ÿçµæ´»**
   - åªè¯†åˆ«æ ‡å‡†çš„ Title/Header å…ƒç´ 
   - ä¸æ”¯æŒä¸­æ–‡æ ‡é¢˜æ¨¡å¼ï¼ˆä¸€ã€äºŒã€1. 2. ç­‰ï¼‰

---

## âœ… ä¼˜åŒ–æ–¹æ¡ˆ

### 1. å¤šå±‚æ¬¡åˆ‡ç‰‡ç­–ç•¥

```
ç­–ç•¥å±‚æ¬¡ï¼š
1ï¸âƒ£ æ ‡é¢˜åˆ‡åˆ†ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
   â†“ è¯†åˆ«å¤±è´¥
2ï¸âƒ£ æ®µè½åˆ‡åˆ† + é•¿åº¦é™åˆ¶
   â†“ æ®µè½è¿‡é•¿
3ï¸âƒ£ å›ºå®šå­—ç¬¦æ•°å¼ºåˆ¶åˆ‡åˆ†
```

**ä¼˜åŠ¿**ï¼š

- ä¿è¯å³ä½¿æ²¡æœ‰æ ‡é¢˜ï¼Œä¹Ÿèƒ½åˆç†åˆ‡åˆ†
- æ¯ä¸ª chunk å¤§å°å¯æ§

### 2. å¢å¼ºæ ‡é¢˜è¯†åˆ«

**æ–°å¢ä¸­æ–‡æ ‡é¢˜æ¨¡å¼**ï¼š

```python
title_patterns = [
    r"^[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+[ã€\.]\s*.+",     # ä¸€ã€ æˆ– ä¸€.
    r"^\d+[ã€\.]\s*.+",                           # 1ã€ æˆ– 1.
    r"^ç¬¬[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å\d]+[ç« èŠ‚éƒ¨åˆ†]\s*.+",  # ç¬¬ä¸€ç« 
    r"^[ï¼ˆ\(]\d+[ï¼‰\)]\s*.+",                      # (1) æˆ– ï¼ˆ1ï¼‰
]
```

**æ•ˆæœ**ï¼š

- å³ä½¿ Word æ–‡æ¡£æ²¡æœ‰ä½¿ç”¨æ ‡å‡†æ ‡é¢˜æ ·å¼
- ä»å¯é€šè¿‡æ–‡æœ¬æ¨¡å¼è¯†åˆ«ç« èŠ‚

### 3. é•¿åº¦æ§åˆ¶æœºåˆ¶

| å‚æ•°             | é»˜è®¤å€¼ | è¯´æ˜                   |
| ---------------- | ------ | ---------------------- |
| `max_chunk_size` | 800    | å•ä¸ª chunk æœ€å¤§å­—ç¬¦æ•°  |
| `min_chunk_size` | 100    | å•ä¸ª chunk æœ€å°å­—ç¬¦æ•°  |
| `chunk_overlap`  | 100    | chunk ä¹‹é—´çš„é‡å å­—ç¬¦æ•° |

**é•¿åº¦æ§åˆ¶æµç¨‹**ï¼š

```
æ–‡æœ¬å— â†’ æ˜¯å¦è¶…è¿‡ max_chunk_sizeï¼Ÿ
         â”œâ”€ å¦ â†’ ç›´æ¥åˆ›å»º chunk
         â””â”€ æ˜¯ â†’ æŒ‰æ®µè½åˆ‡åˆ†
                  â†“
                 å•ä¸ªæ®µè½æ˜¯å¦è¶…é•¿ï¼Ÿ
                  â”œâ”€ å¦ â†’ ç´¯ç§¯æ®µè½ç›´åˆ°è¾¾åˆ° max_chunk_size
                  â””â”€ æ˜¯ â†’ å¼ºåˆ¶æŒ‰å­—ç¬¦æ•°åˆ‡åˆ†ï¼ˆä¼˜å…ˆåœ¨å¥å·å¤„ï¼‰
```

### 4. é‡å æœºåˆ¶ï¼ˆOverlapï¼‰

**ä½œç”¨**ï¼š

- æé«˜æ£€ç´¢å¬å›ç‡
- é¿å…å…³é”®ä¿¡æ¯åœ¨ chunk è¾¹ç•Œä¸¢å¤±

**å®ç°**ï¼š

```python
# ç¤ºä¾‹ï¼šchunk_overlap = 100
Chunk 1: [0:800]        "...å‰é¢å†…å®¹...è¿™æ˜¯é‡å åŒºåŸŸ"
Chunk 2:      [700:1500] "è¿™æ˜¯é‡å åŒºåŸŸ...åé¢å†…å®¹..."
              â†‘
         é‡å  100 å­—ç¬¦
```

### 5. æ™ºèƒ½å›¾ç‰‡åˆ†é…

**ç­–ç•¥ 1ï¼šå‡åŒ€åˆ†é…**ï¼ˆæ¨èï¼‰

```
14 å¼ å›¾ç‰‡ â†’ 10 ä¸ª chunks
- Chunk 1-9: å„ 1 å¼ å›¾ç‰‡
- Chunk 10: 5 å¼ å›¾ç‰‡ï¼ˆå‰©ä½™ï¼‰
```

**ç­–ç•¥ 2ï¼šé›†ä¸­åˆ†é…**

```
14 å¼ å›¾ç‰‡ â†’ å…¨éƒ¨åˆ†é…ç»™ç¬¬ä¸€ä¸ª chunk
```

### 6. å›¾ç‰‡åŸä½ç½®æ’å…¥ï¼ˆæ–°åŠŸèƒ½ï¼‰

**é—®é¢˜èƒŒæ™¯**ï¼š

- åŸæ¥çš„æ–¹æ¡ˆä¸­ï¼Œå›¾ç‰‡æ˜¯ä½œä¸º"é™„ä»¶"æŒ‚åœ¨ chunk åé¢
- å›¾ç‰‡ä¸æ–‡æœ¬çš„ä½ç½®å…³ç³»ä¸¢å¤±ï¼Œä¸åˆ©äºç†è§£ä¸Šä¸‹æ–‡

**è§£å†³æ–¹æ¡ˆ**ï¼š

- åˆ©ç”¨ `unstructured` è§£ææ—¶äº§ç”Ÿçš„ `Image` å…ƒç´ 
- åœ¨å›¾ç‰‡åŸä½ç½®æ’å…¥ `[IMG:path]` å ä½ç¬¦
- HTML å±•ç¤ºæ—¶å°†å ä½ç¬¦è½¬æ¢ä¸ºå®é™…çš„ `<img>` æ ‡ç­¾

**å®ç°åŸç†**ï¼š

```
æ–‡æ¡£è§£ææµç¨‹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸå§‹æ–‡æ¡£                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚æ–‡æœ¬1â”‚  â”‚å›¾ç‰‡1â”‚  â”‚æ–‡æœ¬2â”‚  â”‚å›¾ç‰‡2â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ unstructured è§£æ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Elements åˆ—è¡¨ï¼š                      â”‚
â”‚ [Text, Image, Text, Image, ...]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ æ£€æµ‹åˆ° Image å…ƒç´ æ—¶æ’å…¥å ä½ç¬¦
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡æœ¬å†…å®¹ï¼š                           â”‚
â”‚ "æ–‡æœ¬1\n[IMG:å›¾ç‰‡1è·¯å¾„]\næ–‡æœ¬2\n..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ HTML æ¸²æŸ“æ—¶æ›¿æ¢å ä½ç¬¦
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTML å±•ç¤ºï¼š                          â”‚
â”‚ æ–‡æœ¬1                                â”‚
â”‚ <img src="å›¾ç‰‡1è·¯å¾„">               â”‚
â”‚ æ–‡æœ¬2                                â”‚
â”‚ ...                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•ˆæœå¯¹æ¯”**ï¼š

| ç‰¹æ€§       | åŸæ–¹æ¡ˆ       | æ–°æ–¹æ¡ˆ                                   |
| ---------- | ------------ | ---------------------------------------- |
| å›¾ç‰‡ä½ç½®   | æ–‡æœ¬æœ«å°¾é™„åŠ  | åŸæ–‡ä½ç½®å†…è”                             |
| ä¸Šä¸‹æ–‡å…³ç³» | ä¸¢å¤±         | ä¿ç•™                                     |
| HTML å±•ç¤º  | å›¾ç‰‡å•ç‹¬åŒºåŸŸ | å›¾ç‰‡åµŒå…¥æ–‡æœ¬æµ                           |
| é€‚ç”¨æ ¼å¼   | æ‰€æœ‰æ ¼å¼     | Word/PDFï¼ˆä¾èµ– unstructured Image å…ƒç´ ï¼‰ |

**æ³¨æ„äº‹é¡¹**ï¼š

- å¦‚æœ `unstructured` æœªèƒ½è¯†åˆ«åˆ° `Image` å…ƒç´ ï¼Œå›¾ç‰‡ä¼šå›é€€åˆ°"å‡åŒ€åˆ†é…"ç­–ç•¥
- Markdown æ–‡æ¡£ä»ä½¿ç”¨åŸæœ‰çš„å›¾ç‰‡æ ‡è®°è¯†åˆ«æ–¹å¼

---

## ğŸ¯ æ¨èé…ç½®æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šå¹³è¡¡å‹ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå¤§å¤šæ•°æ–‡æ¡£ï¼Œå¹³è¡¡æ£€ç´¢ç²¾åº¦å’Œè¦†ç›–ç‡

```python
config = ChunkingConfig(
    max_chunk_size=800,           # çº¦400å­—å·¦å³
    min_chunk_size=100,           # é¿å…ç¢ç‰‡åŒ–
    chunk_overlap=100,            # 12.5% é‡å 
    split_by_title=True,          # ä¼˜å…ˆæ ‡é¢˜
    split_by_paragraph=True,      # æ®µè½åˆ‡åˆ†
    force_max_size=True,          # å¼ºåˆ¶é™åˆ¶
    distribute_images_evenly=True # å›¾ç‰‡å‡åŒ€åˆ†é…
)
```

**æ•ˆæœé¢„ä¼°**ï¼š

- ä¸€ä»½ 5000 å­—æ–‡æ¡£ â†’ çº¦ 7-10 ä¸ª chunks
- æ£€ç´¢æ—¶èƒ½ç²¾ç¡®å®šä½åˆ°ç›¸å…³æ®µè½

### æ–¹æ¡ˆ Bï¼šç»†ç²’åº¦å‹

**é€‚ç”¨åœºæ™¯**ï¼šå†…å®¹å¯†é›†ã€éœ€è¦ç²¾ç¡®æ£€ç´¢

```python
config = ChunkingConfig(
    max_chunk_size=500,           # æ›´å°çš„å—
    min_chunk_size=50,
    chunk_overlap=150,            # 30% é‡å 
    split_by_title=True,
    split_by_paragraph=True,
    force_max_size=True,
    distribute_images_evenly=True
)
```

**æ•ˆæœ**ï¼š

- æ£€ç´¢æ›´ç²¾ç¡®
- chunk æ•°é‡æ›´å¤š
- å‘é‡å­˜å‚¨ç©ºé—´éœ€æ±‚å¢åŠ 

### æ–¹æ¡ˆ Cï¼šç²—ç²’åº¦å‹

**é€‚ç”¨åœºæ™¯**ï¼šé•¿æ–‡æ¡£ã€ä¸Šä¸‹æ–‡ä¾èµ–å¼º

```python
config = ChunkingConfig(
    max_chunk_size=1500,          # æ›´å¤§çš„å—
    min_chunk_size=200,
    chunk_overlap=200,
    split_by_title=True,
    split_by_paragraph=True,
    force_max_size=True,
    distribute_images_evenly=False  # å›¾ç‰‡é›†ä¸­
)
```

**æ•ˆæœ**ï¼š

- ä¿ç•™æ›´å¤šä¸Šä¸‹æ–‡
- chunk æ•°é‡è¾ƒå°‘
- å•æ¬¡æ£€ç´¢è¿”å›æ›´å¤šä¿¡æ¯

---

## ğŸ“Š ä¼˜åŒ–å‰åå¯¹æ¯”

| æŒ‡æ ‡           | åŸç‰ˆ            | ä¼˜åŒ–ç‰ˆ                  |
| -------------- | --------------- | ----------------------- |
| **åˆ‡ç‰‡ç­–ç•¥**   | ä»…æ ‡é¢˜          | æ ‡é¢˜ + æ®µè½ + é•¿åº¦é™åˆ¶  |
| **æ ‡é¢˜è¯†åˆ«**   | ä»… Title/Header | + ä¸­æ–‡æ¨¡å¼              |
| **é•¿åº¦æ§åˆ¶**   | âŒ æ—            | âœ… å¯é…ç½®               |
| **é‡å æœºåˆ¶**   | âŒ æ—            | âœ… å¯é…ç½®               |
| **å›¾ç‰‡åˆ†é…**   | ç®€å•            | æ™ºèƒ½å‡åŒ€                |
| **æ£€ç´¢å¬å›ç‡** | ä½ï¼ˆå¤§ chunkï¼‰  | é«˜ï¼ˆé€‚ä¸­ chunk + é‡å ï¼‰ |

### å®é™…æ¡ˆä¾‹

**æ–‡æ¡£**ï¼šTRON1 RL è®­ç»ƒéƒ¨ç½²å¿«é€Ÿä¸Šæ‰‹ï¼ˆIsaac Gymï¼‰.docx

- çº¦ 3000 å­—
- 14 å¼ å›¾ç‰‡

**åŸç‰ˆç»“æœ**ï¼š

```
âœ… è§£æå®Œæˆ: 1 ä¸ªå—
  - Chunk 1: 3000 å­—ç¬¦ï¼ˆæ•´ä¸ªæ–‡æ¡£ï¼‰
  - å›¾ç‰‡: 14 å¼ 
```

**ä¼˜åŒ–ç‰ˆç»“æœï¼ˆé…ç½® max_chunk_size=800ï¼‰**ï¼š

```
âœ… è§£æå®Œæˆ: çº¦ 5-6 ä¸ªå—
  - Chunk 1: ~800 å­—ç¬¦ï¼ˆå®‰è£…éƒ¨åˆ†ï¼‰
  - Chunk 2: ~800 å­—ç¬¦ï¼ˆé…ç½®éƒ¨åˆ†ï¼‰
  - Chunk 3: ~800 å­—ç¬¦ï¼ˆè®­ç»ƒéƒ¨åˆ†ï¼‰
  - Chunk 4: ~800 å­—ç¬¦ï¼ˆéƒ¨ç½²éƒ¨åˆ†ï¼‰
  - Chunk 5: ~600 å­—ç¬¦ï¼ˆFAQï¼‰
  - å›¾ç‰‡å‡åŒ€åˆ†é…åˆ°å„ chunk
```

**æ£€ç´¢æ•ˆæœå¯¹æ¯”**ï¼š
| æŸ¥è¯¢ | åŸç‰ˆ Top1 | ä¼˜åŒ–ç‰ˆ Top1 |
|------|-----------|-------------|
| "å¦‚ä½•å®‰è£… Isaac Gymï¼Ÿ" | æ•´ä¸ªæ–‡æ¡£ï¼ˆç›¸å…³æ€§ä½ï¼‰ | Chunk 1 å®‰è£…éƒ¨åˆ†ï¼ˆç²¾ç¡®ï¼‰ |
| "è®­ç»ƒè¿‡ç¨‹ä¸­å¦‚ä½•ç›‘æ§ï¼Ÿ" | æ•´ä¸ªæ–‡æ¡£ï¼ˆç›¸å…³æ€§ä½ï¼‰ | Chunk 3 è®­ç»ƒéƒ¨åˆ†ï¼ˆç²¾ç¡®ï¼‰ |
| "éƒ¨ç½²åˆ°çœŸæœºçš„æ­¥éª¤" | æ•´ä¸ªæ–‡æ¡£ï¼ˆç›¸å…³æ€§ä½ï¼‰ | Chunk 4 éƒ¨ç½²éƒ¨åˆ†ï¼ˆç²¾ç¡®ï¼‰ |

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åŸºç¡€ä½¿ç”¨

```python
from rag_text_image_optimized import OptimizedDocumentParser, ChunkingConfig

# ä½¿ç”¨é»˜è®¤é…ç½®
parser = OptimizedDocumentParser()
chunks = parser.parse("your_document.docx")

print(f"ç”Ÿæˆ {len(chunks)} ä¸ªå—")
for chunk in chunks:
    print(f"- {chunk.section}: {len(chunk.text)} å­—ç¬¦")
```

### 2. è‡ªå®šä¹‰é…ç½®

```python
# åˆ›å»ºé…ç½®
config = ChunkingConfig(
    max_chunk_size=800,
    chunk_overlap=100,
    split_by_title=True,
    split_by_paragraph=True
)

# ä½¿ç”¨é…ç½®
parser = OptimizedDocumentParser(
    image_output_dir="./images",
    config=config
)

chunks = parser.parse("document.docx")
```

### 3. æ‰¹é‡å¤„ç†

```python
# å¤„ç†æ•´ä¸ªç›®å½•
chunks = parser.parse_directory(
    dir_path="./data",
    extensions=[".docx", ".md", ".pdf"]
)
```

### 4. å­˜å‚¨åˆ° Milvus

```python
from milvusRAG.milvus_util import MilvusUtil
from rag_text_image_optimized import RAGImageStore

# åˆå§‹åŒ–
milvus = MilvusUtil(collection_name="docs_optimized", drop_old=True)
milvus.connect()
milvus.setup_database()
milvus.init_embeddings()
milvus.create_vector_store()

# å­˜å‚¨
store = RAGImageStore(milvus)
store.index_chunks(chunks)

# æ£€ç´¢
results = store.search("ä½ çš„æŸ¥è¯¢", top_k=5)
```

---

## ğŸ”§ å‚æ•°è°ƒä¼˜å»ºè®®

### æ ¹æ®æ–‡æ¡£ç‰¹ç‚¹è°ƒæ•´

**1. æŠ€æœ¯æ–‡æ¡£ï¼ˆå¦‚æœ¬æ¡ˆä¾‹ï¼‰**

```python
max_chunk_size=800      # é€‚ä¸­å¤§å°
chunk_overlap=100       # ä¿ç•™ä¸Šä¸‹æ–‡
split_by_paragraph=True # æŒ‰é€»è¾‘æ®µè½
```

**2. é•¿ç¯‡æ–‡ç« /å°è¯´**

```python
max_chunk_size=1500     # ä¿ç•™æƒ…èŠ‚è¿è´¯æ€§
chunk_overlap=200       # æ›´å¤šé‡å 
split_by_paragraph=True
```

**3. é—®ç­”/FAQ**

```python
max_chunk_size=400      # å°å—ï¼Œç²¾ç¡®åŒ¹é…
chunk_overlap=50        # å°‘é‡å 
split_by_paragraph=True # æŒ‰é—®é¢˜åˆ‡åˆ†
```

**4. æ··åˆæ ¼å¼æ–‡æ¡£**

```python
max_chunk_size=1000     # ç¨å¤§ï¼Œå®¹çº³å¤šç§å†…å®¹
chunk_overlap=150
split_by_title=True     # å¼ºä¾èµ–æ ‡é¢˜
```

### æ ¹æ®æ£€ç´¢æ•ˆæœè°ƒæ•´

**ç—‡çŠ¶ 1ï¼šæ£€ç´¢ç»“æœå¤ªå®½æ³›**

```
â†’ å‡å° max_chunk_sizeï¼ˆå¦‚ 800 â†’ 500ï¼‰
â†’ å‡å°‘ chunk_overlapï¼ˆå¦‚ 100 â†’ 50ï¼‰
```

**ç—‡çŠ¶ 2ï¼šæ£€ç´¢é—æ¼ç›¸å…³å†…å®¹**

```
â†’ å¢åŠ  chunk_overlapï¼ˆå¦‚ 100 â†’ 200ï¼‰
â†’ å¢å¤§ max_chunk_sizeï¼ˆå¦‚ 800 â†’ 1000ï¼‰
```

**ç—‡çŠ¶ 3ï¼šä¸Šä¸‹æ–‡ä¸è¶³**

```
â†’ å¢å¤§ max_chunk_size
â†’ å¢åŠ  chunk_overlap
```

---

## ğŸ“ˆ æ€§èƒ½ä¸èµ„æº

### å­˜å‚¨ç©ºé—´

**åŸç‰ˆ**ï¼ˆ1 chunkï¼‰:

```
å‘é‡ç»´åº¦: 1536
å­˜å‚¨: 1 Ã— 1536 = 1536 ç»´åº¦ç©ºé—´
```

**ä¼˜åŒ–ç‰ˆ**ï¼ˆ6 chunks, overlap=100ï¼‰:

```
å‘é‡ç»´åº¦: 1536
å­˜å‚¨: 6 Ã— 1536 = 9216 ç»´åº¦ç©ºé—´
å¢åŠ : 6 å€
```

### æ£€ç´¢é€Ÿåº¦

- **Chunk æ•°é‡å¢åŠ ** â†’ å‘é‡æœç´¢ç©ºé—´å¢å¤§
- **å½±å“**ï¼šçº¦ 10-20% çš„æ£€ç´¢å»¶è¿Ÿå¢åŠ 
- **ä¼˜åŒ–**ï¼šä½¿ç”¨ Milvus çš„ç´¢å¼•ä¼˜åŒ–ï¼ˆIVFã€HNSWï¼‰

### ç´¢å¼•æ—¶é—´

- **ä¼˜åŒ–ç‰ˆç¨æ…¢**ï¼šéœ€è¦æ›´å¤šåˆ‡åˆ†è®¡ç®—
- **å½±å“**ï¼šçº¦ 20-30% æ—¶é—´å¢åŠ 
- **ä¸€æ¬¡æ€§æˆæœ¬**ï¼šç´¢å¼•åæ£€ç´¢æ”¶ç›Šé•¿æœŸ

---

## âœ¨ é¢„æœŸæ•ˆæœ

ä½¿ç”¨ä¼˜åŒ–é…ç½®åï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. **Chunk æ•°é‡å¢åŠ **

   - ä» 1 ä¸ª â†’ 5-10 ä¸ªï¼ˆå–å†³äºæ–‡æ¡£é•¿åº¦ï¼‰

2. **æ£€ç´¢ç²¾åº¦æå‡**

   - Top 1 å‘½ä¸­ç‡ï¼š~40% â†’ ~80%
   - Top 3 åŒ…å«ç›¸å…³å†…å®¹ï¼š~60% â†’ ~95%

3. **ä¸Šä¸‹æ–‡è´¨é‡**

   - è¿”å›çš„æ–‡æœ¬æ›´èšç„¦
   - å‡å°‘æ— å…³å†…å®¹å¹²æ‰°

4. **å›¾ç‰‡å…³è”æ›´åˆç†**
   - å›¾ç‰‡åˆ†å¸ƒåœ¨ç›¸å…³æ–‡æœ¬å—
   - æŸ¥è¯¢æ—¶æ›´å®¹æ˜“æ‰¾åˆ°é…å›¾

---

## ğŸ“ è¿›é˜¶ä¼˜åŒ–

### 1. åŠ¨æ€ Chunk å¤§å°

æ ¹æ®å†…å®¹ç±»å‹è‡ªé€‚åº”è°ƒæ•´ï¼š

````python
# ä»£ç å—ï¼šè¾ƒå¤§ chunk
if "```" in text:
    max_chunk_size = 1500

# åˆ—è¡¨ï¼šè¾ƒå° chunk
elif re.match(r"^\d+\.", text):
    max_chunk_size = 600
````

### 2. è¯­ä¹‰åˆ†å‰²

ä½¿ç”¨ NLP æ¨¡å‹è¯†åˆ«è¯­ä¹‰è¾¹ç•Œï¼š

```python
from nltk import sent_tokenize
sentences = sent_tokenize(text)
# æŒ‰å¥å­ç´¯ç§¯åˆ° max_chunk_size
```

### 3. å…³é”®è¯å¢å¼º

ä¸ºæ¯ä¸ª chunk æ·»åŠ å…³é”®è¯ï¼š

```python
from jieba.analyse import extract_tags
keywords = extract_tags(chunk.text, topK=5)
chunk.metadata["keywords"] = keywords
```

### 4. æ··åˆæ£€ç´¢

ç»“åˆå…³é”®è¯å’Œå‘é‡æ£€ç´¢ï¼š

```python
# 1. å…³é”®è¯è¿‡æ»¤
candidates = filter_by_keywords(query)

# 2. å‘é‡æ’åº
results = vector_search(query, candidates)
```

---

## ğŸ“š æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

| æ”¹è¿›ç‚¹          | æ•ˆæœ           |
| --------------- | -------------- |
| âœ… å¤šå±‚æ¬¡åˆ‡ç‰‡   | ä¿è¯åˆç†åˆ‡åˆ†   |
| âœ… é•¿åº¦é™åˆ¶     | é¿å…è¶…å¤§ chunk |
| âœ… é‡å æœºåˆ¶     | æé«˜å¬å›ç‡     |
| âœ… å¢å¼ºæ ‡é¢˜è¯†åˆ« | é€‚é…ä¸­æ–‡æ–‡æ¡£   |
| âœ… æ™ºèƒ½å›¾ç‰‡åˆ†é… | æ”¹å–„æ£€ç´¢ä½“éªŒ   |

### æ¨èé…ç½®

**èµ·æ­¥é…ç½®**ï¼š

```python
ChunkingConfig(
    max_chunk_size=800,
    chunk_overlap=100,
    split_by_title=True,
    split_by_paragraph=True
)
```

### åç»­ä¼˜åŒ–æ–¹å‘

1. æ ¹æ®å®é™…æ£€ç´¢æ•ˆæœè°ƒæ•´å‚æ•°
2. è€ƒè™‘æ–‡æ¡£ç±»å‹å·®å¼‚åŒ–é…ç½®
3. å¼•å…¥è¯­ä¹‰åˆ†å‰²å’Œå…³é”®è¯å¢å¼º
4. å®ç°æ··åˆæ£€ç´¢ç­–ç•¥

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `rag_text_image.py` - åŸç‰ˆå®ç°
- `rag_text_image_optimized.py` - ä¼˜åŒ–ç‰ˆå®ç°
- `milvusRAG/milvus_util.py` - å‘é‡å­˜å‚¨å·¥å…·

---

**ä½œè€…**ï¼šAI Assistant  
**æ›´æ–°æ—¥æœŸ**ï¼š2025-12-09  
**ç‰ˆæœ¬**ï¼šv1.0
